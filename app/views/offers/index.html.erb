<% content_for :head do %>

<script>
function callMeOften()
 {
          $.ajax({
                  method: 'get',
                  url : '/offers.js',
		  data: "gate_id=<%=@gate.id%>", 
                  success: function(data){data;}
                   });
 
 };
 
 var holdTheInterval = setInterval(callMeOften, <%=AJAX_CALLS_MILLISECONDS%>);

</script>
<%end %>

<strong> <%= @track.track_alias%>: <%= link_to @track.name, track_path(@track.id),  :class => 'btn btn-mini btn-success'%></strong> ->
<strong>  <%= @track.meet_alias%>: <%= link_to @meet.name, @meet,  :class => 'btn btn-mini btn-success' %>
</strong>->
<strong><%= @track.card_alias%>: <%= link_to @race.card.name, card_path(:id => @race.card.id),:class => 'btn btn-mini btn-success' %></strong>
<strong><%= @track.race_alias%>: <%= link_to @race.name, race_path(:id => @race.id),:class => 'btn btn-mini btn-success' %></strong><br /><br /

     <strong><%= link_to "All My Contracts for #{@gate.horse.name}" , contracts_gate_path(:id => @gate.id), :class => 'btn btn-mini' %> </strong> <br /><br />
<% if @race.open? %>
 <div id='offers'>
 <div id='buy_offers'>
<h1>Offers for <%= "Gate Number: #{@gate.number}: #{@gate.horse.name}" %></h1>
<h3><%=@card.description %></h3>
<h4><%=@race.description %></h4>

<h2>Listing Sell Offers</h2>
<h5>What it would cost to Buy, Go Long or Back a contract on <%= "Gate Number: #{@gate.number}: #{@gate.horse.name}" %>
<%= link_to 'Buy One Contract at Market', buy_contracts_path(:gate_id => @gate.id, :market => 'Market', :number => 1, :offer_type => 'Buy'), :class => 'btn btn-success', data: { confirm: 'Are you sure? This will buy one contract at Market.'} %>

<%= link_to 'New Sell Offer', new_offer_path(:gate_id => @gate.id, :offer_type => 'Sell'), :class => 'btn btn-success' %>
<table class='table table-striped table-bordered table-condensed' id='buy_offers'>
  <tr>
    <th>Position</th>
    <th>Player</th>
    <th>Price</th>

    <th>Expires</th>

    <th>Number</th>

  </tr>

<% @sell_offers.each_with_index do |offer, index| %>
  <%if index == 0 and offer.user.id != current_user.id %>
    <tr class='market'>
  <%elsif offer.user.id == current_user.id %>
    <tr class='same'>
  <%else%>
    <tr>
  <% end %>
    <td><%= index + 1 %></td>
    <td><%= offer.user.name %></td>
    <td><%= offer.price %></td>
    <td><%= distance_of_time_in_words_to_now(offer.expires) unless offer.expires.blank? %></td>
    <td><%= offer.number %></td>
  <%if index == 0 and offer.user.id != current_user.id %>
    <td><%= link_to 'Buy', buy_contracts_path(:gate_id => @gate.id, :market => 'Market', :number => 1, :offer_type => 'Buy', :offer_id => offer.id), :class => 'btn btn-success', data: { confirm: 'Are you sure? This will buy one contract at Market.'} %></td>
  <%end%>
  </tr>
<% end %>

</table>
</div>

 <div id='sell_offers'>
<h2>Listing Buy Offers</h1>
<h5>What it would bring to Sell, Short or Lay a contract on <%= "Gate Number: #{@gate.number}: #{@gate.horse.name}" %></h5>
<%= link_to 'Sell One Contract at Market', buy_contracts_path(:gate_id => @gate.id, :market => 'Market', :number => 1, :offer_type => 'Sell'), :class => 'btn btn-success', data: { confirm: 'Are you sure? This will sell one contract at Market.'}  %>
<%= link_to 'New Buy Offer', new_offer_path(:gate_id => @gate.id, :offer_type => 'Buy'), :class => 'btn btn-success' %>
<table class='table table-striped table-bordered table-condensed'>
  <tr>

    <th>Position</th>
    <th>Player</th>
    <th>Price</th>
    <th>Expires</th>

    <th>Number of Contracts</th>
    <th></th>
    <th></th>
    <th></th>
  </tr>


<% @buy_offers.each_with_index do |offer, index| %>
  <%if index == 0 and offer.user.id != current_user.id %>
    <tr class='market'>
  <%elsif offer.user.id == current_user.id %>
    <tr class='same'>
  <%else%>
    <tr>
  <% end %>
      <td><%= index + 1 %></td>
    <td><%= offer.user.name %></td>
      <td><%= offer.price %></td>
      <td><%= distance_of_time_in_words_to_now(offer.expires) unless offer.expires.blank? %></td>

      <td><%= offer.number %></td>
  <%if index == 0 and offer.user.id != current_user.id %>
    <td><%= link_to 'Sell', buy_contracts_path(:gate_id => @gate.id, :market => 'Market', :number => 1, :offer_type => 'Sell', :offer_id => offer.id), :class => 'btn btn-success', data: { confirm: 'Are you sure? This will buy one contract at Market.'} %></td>
  <%end%>
    </tr>

<% end %>

</table>

<br />
<%else%>
<h4><%=@race.betting_status %></h4>
<%end%>

<br />
</div>

